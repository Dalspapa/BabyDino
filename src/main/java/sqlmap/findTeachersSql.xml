<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="dino.findTeachers">

	<select id="teacherList" resultType="dino.findteachers.model.FindTeacherJoinDto">
		  SELECT 
                m.idx
                ,m.name
                ,(TO_CHAR(SYSDATE ,'yyyy') - TO_CHAR (birth, 'yyyy')) as age
                ,m.gender
                ,t.t_care_type
                ,t.t_cost
                ,t.t_introduce
                ,ci.c_imgpath
            FROM 
                d_teachercard t
            LEFT JOIN 
                d_member m ON m.idx = t.d_member_idx
            LEFT JOIN 
                d_common_img ci ON ci.d_member_idx = t.idx
            WHERE
                t.d_member_idx = m.idx
	</select>
	
	<!-- pick kid card -->
	<select id="pickKidsCard" parameterType="int" resultType="dino.dto.KidDto">
	SELECT
			a.idx,
			a.k_name, 
			a.k_gender, 
			a.k_birth,
            b.*
		FROM 
			d_kidcard a, 
            (SELECT
            idx as xidx,
			(TO_CHAR(SYSDATE ,'yyyy') -
            TO_CHAR (k_birth, 'yyyy')) as age
            FROM 
                d_kidcard
            WHERE 
                d_member_idx = #{idx}) b
    WHERE 
        a.idx = b.xidx
	</select>
	
	<!-- pick addr card -->
	<select id="pickAddr" parameterType="int" resultType="dino.dto.MemberDto">
	SELECT
    	idx,
    	addr1,
    	addr2,
    	addr3
	FROM
    	d_member
	WHERE
    	idx = #{idx}
	</select>
	
	<!-- pick addr card 
	나중에 추가
	parameterType="int"  -->
	<select id="getaddr" resultType="dino.dto.MemberDto">
	SELECT
    	idx,
    	addr1,
    	addr2,
    	addr3
	FROM
    	d_member
	WHERE
    	idx = #{idx}
	</select>
	
	
	<!-- update addr card -->
	<update id="upAddr" parameterType="dino.dto.MemberDto">
	UPDATE
		d_member
	SET
		addr1 = #{addr1},
		addr2 = #{addr2},
		addr3 = #{addr3}
	WHERE
		idx = #{idx}
	</update>
	
	<!-- make kid card --> 
	<insert id="k_makeCard" parameterType="dino.dto.KidDto">
	INSERT INTO 
                d_kidcard
        VALUES(
                d_kidcard_idx.nextval,
               #{idx},
                #{k_name},
                2,
                #{k_birth},
                #{k_introduce},
                #{k_care_type},
                #{k_tendency},
               	#{teacher_type},
               	#{k_require}
        )
	</insert>
	
	<insert id="k_reserve" parameterType="dino.dto.ReserveDto">
	INSERT INTO
	    	 d_reserve
		VALUES(
		    D_RESERVE_IDX.nextval,
		    #{idx},
		    #{kid_idx},
		    to_date(#{start_date}, 'yyyy-mm-dd hh24'),
		    to_date(#{end_date}, 'yyyy-mm-dd hh24'),
		    #{cost},
		    1,
		    null,
		    null,
		    null
	)
	</insert>
	
	<!-- <insert id="kSetImg" parameterType="dino.dto.Common_ImgDto">
		INSERT INTO
			d_common_img
		VALUES(
			d_common_img_idx.nextval,
			#{c_imgpath},
			#{d_member_idx},
			1,
			#{ref_idx}
		)
	</insert>
	 -->
	<!-- <select id="getImg" parameterType="Integer" resultType="dino.dto.Common_ImgDto" >
	    SELECT 
	        dk.*, dci.c_imgpath
	    FROM 
	        d_kid dk 
	    LEFT JOIN 
	        d_common_img dci 
	    ON 
	        dk.d_member_idx = dci.d_member_idx
	    WHERE
	        dk.d_member_idx = #{d_member_idx}
	</select>
	 -->
	
	<select id="teacherInfo" parameterType="Integer" resultType="dino.findteachers.model.FindTeacherJoinDto">
		SELECT 
			t.t_cost
			, t.job
			, t.badge
			, t.t_introduce
			, t.schedule_day
			, t.schedule_time
			, t.kid_type
			, t.t_care_type
			, t.career_experience
			, t.cctvagree
			, m.name
			, m.birth
			, m.gender
			, m.addr2
			, i.c_imgpath
		FROM
			d_teachercard t
		LEFT JOIN 
			d_member m ON m.idx = t.d_member_idx
		LEFT JOIN 
			d_common_img i on i.ref_idx = t.idx
		where 
			t.idx = #{idx}
	</select>
	
	<select id="teacherReviewList" resultType="dino.dto.ReviewDto">
		SELECT
			 idx
	     	 , d_reserve_idx
	     	 , d_member_idx
	     	 , star
	     	 , r_writedate
	     	 , r_content
		FROM 
			d_review 
		WHERE 
			d_member_idx = #{idx}
	</select>
</mapper>